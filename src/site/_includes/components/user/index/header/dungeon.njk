<div id="dungeon-map">
  <!-- Debug info -->
  <div style="margin-bottom: 10px; font-size: 12px; color: #666;">
    Grid size: {{ userComputed.dungeon.dungeonGrid.length }}x{{ userComputed.dungeon.dungeonGrid[0].length }}
    <!-- Add debug info for icon positions -->
    | Icons: {{ userComputed.dungeon.dungeonItems.length }}
    | Icon positions: {{ userComputed.dungeon.iconPositionsArray.length }}
  </div>
  
  <!-- Debug: Display first few icon positions -->
  <div style="margin-bottom: 10px; font-size: 12px; color: #666; max-height: 100px; overflow: auto;">
    {% for pos in userComputed.dungeon.iconPositionsArray.slice(0, 5) %}
      ({{ pos.y }},{{ pos.x }}): {{ pos.icon[0] }}, 
    {% endfor %}
    {% if userComputed.dungeon.iconPositionsArray.length > 5 %}...{% endif %}
  </div>
  
  <div class="dungeon-body">
    {% for row in userComputed.dungeon.gridWithIcons %}
      <div class="dungeon-row">
        {% for cell in row %}
          {% if cell.isDungeon %}
            <div class="dungeon-cell" data-y="{{ loop.parent.index0 }}" data-x="{{ loop.index0 }}">
              {% if cell.icon %}
                <a href="{{ cell.icon[1] }}" title="{{ cell.icon[2] }}" class="dungeon-icon-link">
                  <img src="/img/{{ cell.icon[0] }}.svg" alt="{{ cell.icon[2] }}" height="20" width="20" />
                </a>
              {% else %}
                <span class="empty-dungeon"></span>
              {% endif %}
            </div>
          {% else %}
            <div class="empty-cell"></div>
          {% endif %}
        {% endfor %}
      </div>
    {% endfor %}
  </div>
  
  <div class="dungeon-legends">
    {% for count in userComputed.dungeon.legends %}
      <div class="legend-item">
        <img src="/img/{{ count.icon }}.svg" alt="{{ count.label }}" />
        {{count.count}} {% if count.count > 1 %}{% if count.plural %}{{count.plural}}{% else %}{{count.label}}s{% endif %}{% else %}{{count.label}}{% endif %}
      </div>
    {% endfor %}
  </div>
</div>
